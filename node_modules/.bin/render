#!/bin/bash

CWD=$(pwd)

OM_CSS_DIR=${CWD}/node_modules/@orangemethod/asciidoc-common
OM_CSS_FILE=orange-method.css

function processFile {
  if [ ${file: -5} == ".adoc" ]; then
    echo "  Using AsciiDoctor to process file ${file}"
    DIRNAME=$(dirname ${file})
    DIRNAME=${DIRNAME#adoc}
    asciidoctor -D docs${DIRNAME} -a stylesheet=${OM_CSS_FILE} -a stylesdir=${OM_CSS_DIR} ${file}
  else
    echo "  Skipping non-asciidoc file ${file}"
  fi
}

# If user specified files to process, then only process those files;
# Otherwise process all "*.adoc" files.
if [ $# -eq 0 ]; then
  echo "Generating HTML docs:"
  find adoc -name "*.adoc" | while read file; do
    processFile $file
  done
else
  for file in "$@"
  do
    processFile $file
  done
fi

echo "All done."
